Общие замечания к докер-сборке


1) сборка (папка docker) кидается в корень проекта.
В контейнере в корне приложения будет лежать родительская папка относительно папки docker.
Имя проекта (будет префиксом для контейнеров) задаётся в файле .env

2) Подключены PHP 7.4 и MariaDB<br>
Докерфайл для PHP (основной контейнер приложения) лежит по адресу<br>
./php<br>
Если нужна другая версия PHP - меняем данные в параметре FROM<br> 
(Только проверить, что такой образ существует. https://hub.docker.com/_/php)<br>
Если нужен ещё какой-то модуль или расширение - добавлям нужную команду в докер-файл.<br>
Базу можно выбрать и другую - ставим прямо в docker-compose.yml

3) База маппится в папку ./base (поэтому она не боится рестартов докера и даже ребилда)

4) Конфиги апача мапятся в папку ./data/sites<br>
Их можно настроить под конкретное приложение<br>
IP контейнеров смотрим (если надо - меняем) в файле docker-compose.yml<br>
Лучше работать в указанной подсети, менять четвёртый компонент адреса. <br>
При желании добавляем имена хостов и IP  файл hosts<br>

5) Локальные настройки юзера мапятся в папку ./data/root и не сбрасываются докером

6) Системные логи апача мапятся в ./data/LOGS и поэтому всегда доступны на хост-машине

7) Папка ./sql маппится в контейнер базы, /home/sql
Оттуда удобно импортировать большие дампы через консоль контейнера базы

8) в основном приложении глобально устанавливается composer
Можно заходить в контейнер приложения и устанавливать пакеты
<hr>

ЗАПУСК:
Открываем консоль в папке docker. 
Перед первым запуском собираем образы:<br>
docker-compose build

Запуск для работы:<br>
docker-compose up -d

Остановка (временная, не пропадает ничего из изменений в контейнерах)<br>
docker-compose stop

Оставновка полная (пропадут все изменения, кроме тех, что в смапленных папках)<br>
docker-compose down

-------------------------------------------------------------------------------
Описание текущей конфигурации - править под свои нужды
(имя проекта my-docker)

Приложение стартует на IP
172.16.200.99

В конфиге APACHE определены два домена - править под свой случай, лишнее удалить, недостающее добавить<br>
operator.yango <br>
api.yango  

База данных mariaDB на IP<br>
172.16.200.98<br>
юзер root<br>
пароль root<br>
Внутри контейнеров доступна по имени<br> 
db

Adminer стартует на IP
172.16.200.98:8080

Перед импортом базы создаем в админере базу
(например yapartner)

Наш дамп (yapartner.sql) должен лежать в папке
/docker/sql

Для импорта базы заходим внутрь контейнера db из Шторма или в консоли командной
docker exec -it my-docker_db_1 bash

Затем
cd /home/sql
mysql -uroot -proot --default-character-set=utf8 yapartner < yapartner.sql

Пример добавки в файл hosts для доступа по именам:<br>
172.16.200.99 api.yango operator.yango<br>
172.16.200.97 adminer.yango

Не забывать про порт для Adminer:<br>
http://adminer.yango:8080